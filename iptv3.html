<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, orientation=landscape">
<title>IPTV Multinacional</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
/* ðŸ”„ ForÃ§ar orientaÃ§Ã£o horizontal */
@media screen and (orientation:portrait) {
    body {
        transform: rotate(90deg);
        transform-origin: left top;
        width: 100vh;
        height: 100vw;
        overflow-x: hidden;
        position: absolute;
        top: 0;
        left: 0;
    }
}

body{
    margin:0;
    font-family:Arial;
    display:flex;
    height:100vh;
    background:#121212;
    color:#fff;
}

#sidebar{
    width:300px;
    background:#1f1f1f;
    padding:15px;
    overflow-y:auto;
}

#sidebar h2{margin-top:0}

#search{
    width:100%;
    padding:8px;
    margin-bottom:10px;
    border-radius:5px;
    border:none;
}

.category-title{
    font-weight:bold;
    margin:10px 0;
    cursor:pointer;
}

.channel{
    padding:7px;
    border-radius:5px;
    background:#2a2a2a;
    margin-bottom:5px;
    cursor:pointer;
}

.channel:hover{background:#444}

#player-container{
    flex:1;
    background:#000;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
}

video{
    width:95%;
    height:90%;
    border-radius:10px;
}

#epg{
    margin-top:10px;
    width:95%;
    background:#222;
    padding:8px;
    border-radius:5px;
}
</style>
</head>

<body>

<div id="sidebar">
<h2>IPTV</h2>
<input id="search" placeholder="Buscar canal..." onkeyup="filterChannels()">
<div id="channels-container"></div>
</div>

<div id="player-container">
<video id="video" controls autoplay></video>
<div id="epg">Selecione um canal</div>
</div>

<script>
const playlistsExternas = [
    {url:"https://iptv-org.github.io/iptv/countries/ao.m3u", country:"Angola"},
    {url:"https://iptv-org.github.io/iptv/countries/br.m3u", country:"Brasil"},
    {url:"https://iptv-org.github.io/iptv/countries/pt.m3u", country:"Portugal ðŸ‡µðŸ‡¹"},
    {url:"https://iptv-org.github.io/iptv/countries/fr.m3u", country:"FranÃ§a ðŸ‡«ðŸ‡·"},
    {url:"https://iptv-org.github.io/iptv/countries/de.m3u", country:"Alemanha"},
    {url:"https://iptv-org.github.io/iptv/countries/es.m3u", country:"Espanha"}
];

async function fetchM3U(url){
    const r = await fetch(url);
    return await r.text();
}

function parseM3U(text, defaultCategory){
    const lines = text.split("\n");
    const channels = [];
    let current = {};

    lines.forEach(line=>{
        line=line.trim();

        if(line.startsWith("#EXTINF")){
            current={};
            const name = line.match(/,(.+)$/);
            current.name = name ? name[1] : "Canal";

            const group = line.match(/group-title="([^"]+)"/);
            const g = group ? group[1].toLowerCase() : "";

            current.category = g.includes("sport")
                ? "Desporto " + defaultCategory
                : defaultCategory;

            current.epg=current.name;
        }
        else if(line && !line.startsWith("#")){
            current.url=line;
            channels.push(current);
            current={};
        }
    });
    return channels;
}

function loadChannels(channels){
    const container=document.getElementById("channels-container");
    container.innerHTML="";
    const cats=[...new Set(channels.map(c=>c.category))];

    cats.forEach(cat=>{
        const cdiv=document.createElement("div");
        const title=document.createElement("div");
        title.className="category-title";
        title.textContent=cat;
        cdiv.appendChild(title);

        channels.filter(c=>c.category===cat).forEach(ch=>{
            const d=document.createElement("div");
            d.className="channel";
            d.textContent=ch.name;
            d.dataset.name=ch.name.toLowerCase();
            d.onclick=()=>playChannel(ch.url,ch.epg);
            cdiv.appendChild(d);
        });
        container.appendChild(cdiv);
    });
}

const video=document.getElementById("video");
function playChannel(url,epg){
    if(Hls.isSupported()){
        if(window.hls) window.hls.destroy();
        const hls=new Hls();
        window.hls=hls;
        hls.loadSource(url);
        hls.attachMedia(video);
    }else{
        video.src=url;
    }
    document.getElementById("epg").textContent="EPG: "+epg;
}

function filterChannels(){
    const q=document.getElementById("search").value.toLowerCase();
    document.querySelectorAll(".channel").forEach(c=>{
        c.style.display=c.dataset.name.includes(q)?"block":"none";
    });
}

async function init(){
    let all=[];
    for(let p of playlistsExternas){
        try{
            const txt=await fetchM3U(p.url);
            all=[...all,...parseM3U(txt,p.country)];
        }catch(e){}
    }
    loadChannels(all);
}
init();
</script>

</body>
</html>